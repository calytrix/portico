<?xml version="1.0"?>
<!--
                  Welcome to the Portico Build System

       The Portico build system is an artefact-driven, modular, Ant
       based system. The base framework is split up over a number of
       different build files (base structure, macros, etc...) and is
       designed to be extended rather than modified. The full system
       is introduced and described in the online documentation:
       
       http://porticoproject.org/index.php?title=Building_Portico
-->
<project name="ieee1516e">

	<!-- ================================================================================= -->
	<!--                                 General Settings                                  -->
	<!-- ================================================================================= -->
	<description>
		Windows 32-bit C++ build profile for IEEE-1516 (2010) Interface [HLA Evolved]
	</description>

	<!-- ==== Basic Properties ==== -->
	<!-- Get a reference to the JDK we want to use, falling back on the given default -->
	<getJdk property="jdk.home.win32" arch="x86" fallback="${jdk.default.win32}"/>

	<!-- ================================================ -->
	<!-- ==== IEEE-1516e (2010) Interface Properties ==== -->
	<!-- ================================================ -->
	<!-- source -->
	<property name="ieee1516e.src.dir"         location="${cpp.src.dir}/ieee1516e/src"/>
	<property name="ieee1516e.include.dir"     location="${cpp.src.dir}/ieee1516e/include"/>
	<property name="ieee1516e.example.dir"     location="${cpp.src.dir}/ieee1516e/example"/>

	<!-- build -->
	<property name="ieee1516e.build.dir"       location="${build.dir}/cpp/win32/ieee1516e"/>
	<property name="ieee1516e.complete.dir"    location="${ieee1516e.build.dir}/complete"/>

	<!-- =========================================================== -->
	<!--                     Project Libraries                       -->
	<!-- =========================================================== -->
	<!-- ==== Library Path Definitions ==== -->
	<!-- See profiles/project.libraries.xml -->
	<!-- <property name="cppunit.dir"     location="..."/> -->
	<!-- <property name="cppunit.include" location="..."/> -->
	<!-- <property name="cppunit.lib"     location="..."/> -->

	<!-- ================================================================================= -->
	<!--                                   Clean Targets                                   -->
	<!-- ================================================================================= -->
	<target name="clean" extensionOf="cpp.clean">
		<delete dir="${ieee1516e.build.dir}"/>
	</target>

	<!-- ================================================================================= -->
	<!--                                  Compile Targets                                  -->
	<!-- ================================================================================= -->
	<!-- 
	     The parent compilation target. This will compile all the core Portico C++
	     interface and the associated unit test suite code.
	-->
	<target name="compile"
	        extensionOf="cpp.compile"
	        description="Compile 32-bit C++ HLA v1.3 Interface"
	        depends="compile.x86.debug,
	                 compile.x86.release,
	                 example.compile.x86"/>

	<!-- ==================================== -->
	<!--         IEEE-1516e Interface         -->
	<!-- ==================================== -->
	<!--                            -->
	<!-- === Win32 32-bit Debug === -->
	<!--                            -->
	<target name="compile.x86.debug">
		<!-- Build the main DLL -->
		<msvc outfile="librti1516ed"
		      workdir="${ieee1516e.build.dir}/debug"
		      outdir="${ieee1516e.complete.dir}"
		      compilerArgs="${msvc.debug.defaults}"
		      linkerArgs="/DEBUG">
			<fileset dir="${ieee1516e.src.dir}">
				<include name="**/*.cpp"/>
				<exclude name="types/time/LogicalTimeFactoryFactory.cpp"/>
			</fileset>
			<includepath path="${ieee1516e.include.dir}"/>
			<includepath path="${ieee1516e.src.dir}"/>
			<includepath path="${jdk.home.win32}/include;${jdk.home.win32}/include/win32"/>
			<define name="BUILDING_RTI"/>
			<define name="RTI_DISABLE_WARNINGS"/>
			<define name="DEBUG"/>
			<library path="${jdk.home.win32}/lib" libs="jvm"/>
		</msvc>

		<!-- Build the fedtime DLL -->
		<msvc outfile="libfedtime1516ed"
		      workdir="${ieee1516e.build.dir}/debug"
		      outdir="${ieee1516e.complete.dir}"
		      compilerArgs="${msvc.debug.defaults}"
		      linkerArgs="/DEBUG">
			<!-- Filesets and other settings -->
			<fileset dir="${ieee1516e.src.dir}">
				<include name="types/time/LogicalTimeFactoryFactory.cpp"/>
			</fileset>
			<includepath path="${ieee1516e.include.dir}"/>
			<includepath path="${ieee1516e.src.dir}"/>
			<includepath path="${jdk.home.win32}/include;${jdk.home.win32}/include/win32"/>
			<!--<define name="BUILDING_RTI"/> - needed to ensure Exception.cpp stuff works -->
			<define name="BUILDING_FEDTIME"/>
			<define name="RTI_DISABLE_WARNINGS"/>
			<define name="DEBUG"/>
			<library path="${ieee1516e.build.dir}/complete" libs="rti1516ed"/>
			<library path="${jdk.home.win32}/lib" libs="jvm"/>
		</msvc>
	</target>

	<!--                              -->
	<!-- === Win32 32-bit Release === -->
	<!--                              -->
	<target name="compile.x86.release" if="build.release">
		<!-- Build the main DLL -->
		<msvc outfile="librti1516e"
		      workdir="${ieee1516e.build.dir}/release"
		      outdir="${ieee1516e.complete.dir}"
		      compilerArgs="${msvc.release.defaults}">
			<fileset dir="${ieee1516e.src.dir}">
				<include name="**/*.cpp"/>
				<exclude name="types/time/LogicalTimeFactoryFactory.cpp"/>
			</fileset>
			<includepath path="${ieee1516e.include.dir}"/>
			<includepath path="${ieee1516e.src.dir}"/>
			<includepath path="${jdk.home.win32}/include;${jdk.home.win32}/include/win32"/>
			<define name="BUILDING_RTI"/>
			<define name="RTI_DISABLE_WARNINGS"/>
			<library path="${jdk.home.win32}/lib" libs="jvm"/>
		</msvc>

		<!-- Build the fedtime DLL -->
		<msvc outfile="libfedtime1516e"
		      workdir="${ieee1516e.build.dir}/release"
		      outdir="${ieee1516e.complete.dir}"
		      compilerArgs="${msvc.release.defaults}">
			<!-- Filesets and other settings -->
			<fileset dir="${ieee1516e.src.dir}">
				<include name="types/time/LogicalTimeFactoryFactory.cpp"/>
			</fileset>
			<includepath path="${ieee1516e.include.dir}"/>
			<includepath path="${ieee1516e.src.dir}"/>
			<includepath path="${jdk.home.win32}/include;${jdk.home.win32}/include/win32"/>
			<!--<define name="BUILDING_RTI"/> - needed to ensure Exception.cpp stuff works -->
			<define name="BUILDING_FEDTIME"/>
			<define name="RTI_DISABLE_WARNINGS"/>
			<library path="${ieee1516e.build.dir}/complete" libs="rti1516e"/>
			<library path="${jdk.home.win32}/lib" libs="jvm"/>
		</msvc>
	</target>

	<!-- ==================================== -->
	<!--      IEEE-1516e Example Federate     -->
	<!-- ==================================== -->
	<!-- Compiles the 1516e example federate. Doesn't do much except
	     assure that we can actually compile and link it to Portico -->
	<target name="example.compile.x86" depends="compile.x86.debug">
		<msvc outfile="ieee1516e-example"
		      workdir="${ieee1516e.build.dir}/ieee1516e-example"
		      type="executable"
		      compilerArgs="/Zi /Od /EHsc /GR /MTd">
			<fileset dir="${ieee1516e.example.dir}" includes="**/*.cpp"/>
			<includepath path="${ieee1516e.include.dir}"/>
			<define name="DEBUG"/>
			<library path="${ieee1516e.build.dir}/complete" libs="rti1516ed,fedtime1516ed"/>
			<library path="${jdk.home.win32}/lib" libs="jvm"/>
		</msvc>
	</target>

	<!-- ================================================================================= -->
	<!--                                  Testing Targets                                  -->
	<!-- ================================================================================= -->

	<!-- Not implemented for IEEE-1516e Inteface -->
	<target name="test" extensionOf="cpp.test">
		<echo>No unit test suite for the C++ IEEE-1516e Interface</echo>
	</target>

	<!-- ================================================================================= -->
	<!--                                  Sandbox Targets                                  -->
	<!-- ================================================================================= -->
	<!-- 
	     The main sandbox preparation target. This will aggregate together all the various
	     required artefacts scattered around the build environment into the structure that
	     should be present when installed on a users system (relative to the sandbox dir).
	-->
	<target name="sandbox" extensionOf="cpp.sandbox" depends="java.sandbox,compile">
		<!-- ======================= -->
		<!-- Copy across the Headers -->
		<!-- ======================= -->
		<mkdir dir="${dist.sandbox.dir}/include/ieee1516e"/>
		<copy todir="${dist.sandbox.dir}/include/ieee1516e">
			<fileset dir="${ieee1516e.include.dir}" includes="**/*"/>
		</copy>

		<!-- ========================= -->
		<!-- Copy across the libraries -->
		<!-- ========================= -->
		<!-- Copy across the C++ libraries -->
		<mkdir dir="${dist.lib.dir}/vc10"/>
		<copy todir="${dist.lib.dir}/vc10">
			<fileset dir="${ieee1516e.complete.dir}" includes="**/*.lib,**/*.exp,**/*.pdb"/>
		</copy>
		<!-- Copy across the C++ dlls -->
		<mkdir dir="${dist.bin.dir}/vc10"/>
		<copy todir="${dist.bin.dir}/vc10">
			<fileset dir="${ieee1516e.complete.dir}" includes="**/*.dll"/>
		</copy>

		<!-- ================================= -->
		<!-- Copy across the example federates -->
		<!-- ================================= -->
		<mkdir dir="${dist.examples.dir}/cpp/ieee1516e"/>
		<copy todir="${dist.examples.dir}/cpp/ieee1516e">
			<fileset dir="${ieee1516e.example.dir}" includes="**/*"/>
		</copy>
	</target>

	<!-- ================================================================================= -->
	<!--                                 Installer Targets                                 -->
	<!-- ================================================================================= -->
	<!-- Not required for an interface build -->

	<!-- ================================================================================= -->
	<!--                             Release Generation Targets                            -->
	<!-- ================================================================================= -->
	<!-- Not required for an interface build -->

</project>
