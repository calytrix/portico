<?xml version="1.0"?>
<!--
                  Welcome to the Portico Build System

       The Portico build system is an artefact-driven, modular, Ant
       based system. The base framework is split up over a number of
       different build files (base structure, macros, etc...) and is
       designed to be extended rather than modified. The full system
       is introduced and described in the online documentation:
       
       http://porticoproject.org/index.php?title=Building_Portico
-->
<project name="installer.macosx">

	<!-- ================================================================================= -->
	<!--                                 General Settings                                  -->
	<!-- ================================================================================= -->
	<description>
		Mac OS X installation generation.
	</description>

	<!-- ================================================================================= -->
	<!--                             Installer Creation Targets                            -->
	<!-- ================================================================================= -->
	<target name="installer" extensionOf="master.installer">
		<!-- check to make sure the jre dir exists -->
		<echo>Checking to see if JRE is available for bundling</echo>
		<available file="${macosx.jdk.home}/jre" property="jrefound"/>
		<fail unless="jrefound"
		      message="Could not locate JRE dir. Set JAVA_HOME env var to point to JDK install"/>

		<!-- generate the tarball with the sandbox and the JRE in it -->
		<tar destfile="${dist.tgz.file}"
		     compression="gzip"
		     longfile="gnu">
			<tarfileset dir="${dist.sandbox.dir}" includes="**/*"/>
			<tarfileset dir="${macosx.jdk.home}/jre" includes="**/*" prefix="/jre"/>
		</tar>

		<!--<echo>Running MacOS DMG Generation</echo>-->
		
		<!-- Copy across the OS X Portico.app wrapper -->
		<!-- we have to use exec to we can get a permission-preserving copy -->
		<!--
		<echo>Copying Portico.app into distribution</echo>
		<exec executable="cp" failonerror="true">
			<arg line="-R ${resources.installers.dir}/macosx/dmg/Portico.app ${dist.sandbox.dir}/"/>
		</exec>
		-->

		<!-- Run the Disk Image Generation Tool -->
		<!--
		<echo>Generating the DMG File</echo>
		<exec executable="hdiutil">
			<arg value="create"/>
			<arg value="-srcfolder"/>
			<arg value="${dist.sandbox.dir}"/>
			<arg value="-ov"/>
			<arg value="${dist.dir}/${dist.name}.dmg"/>
		</exec>
		-->
	</target>

</project>
